#!/bin/bash -e
# the help
usage() {
    echo ""
    echo "usage:"
    echo "  ham-brew-installdir PACKAGE (KIND{prefix|bin|include|lib})"
    echo ""
    echo "  Prints what should be the installation directory of the specified brew package."
    echo "  Prints nothing if there's no brew install dir."
    if [[ "${BASH_SOURCE[0]}" != "${0}" ]]; then
        # sourced...
        return 1
    else
        # regular call
        exit 1
    fi
}

PKGNAME="$1"
if [[ "$PKGNAME" == *"tap/"* ]]; then
  PKGNAME=$(basename "$PKGNAME")
fi

KIND="${2:-bin}"
case $KIND in
  prefix)
    # M1 mac folder
    if [ -d "/opt/homebrew/opt/" ]; then
      PKG_HOME="/opt/homebrew"
    # Intel mac folder
    elif [ -d "/usr/local/opt/" ]; then
      PKG_HOME="/usr/local"
    else
      PKG_HOME=""
    fi
    echo "${PKG_HOME}"
    ;;
  bin)
    # M1 mac folder
    if [ -d "/opt/homebrew/opt/" ]; then
      PKG_HOME="/opt/homebrew/opt/$PKGNAME"
    # Intel mac folder
    elif [ -d "/usr/local/opt/" ]; then
      PKG_HOME="/usr/local/opt/$PKGNAME"
    else
      PKG_HOME=""
    fi
    echo "${PKG_HOME}"
    ;;
  include)
    # M1 mac folder
    if [ -d "/opt/homebrew/include" ]; then
      PKG_INCLUDE="/opt/homebrew/include/$PKGNAME"
    # Intel mac folder
    elif [ -d "/usr/local/include" ]; then
      PKG_INCLUDE="/usr/local/include/$PKGNAME"
    else
      PKG_INCLUDE=""
    fi
    echo "${PKG_INCLUDE}"
    ;;
  lib)
    # M1 mac folder
    if [ -d "/opt/homebrew/lib" ]; then
      PKG_LIB="/opt/homebrew/lib"
      # Intel mac folder
    elif [ -d "/usr/local/lib" ]; then
      PKG_LIB="/usr/local/lib"
    else
      PKG_LIB=""
    fi
    echo "${PKG_LIB}"
    ;;
  *)
    echo "E/Unknown install kind '$KIND'."
    exit 1
    ;;
esac
