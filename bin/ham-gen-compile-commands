#!/bin/bash
ham -- -n -a -oactions.txt all >/dev/null && ni $HAM_HOME/scripts/gen_compile_commands.ni -f $(pwd)/sources/actions.txt && rm sources/actions.txt

# Generate gtags.files, requires global to be installed
if [ "$1" == gtags ]; then
    if [ -e "$JSON" ]; then
        grep '"file"' compile_commands.json | sed 's~.*"file": "~~g' | sed 's~"~~g' > gtags.files
        if [ ! -e "GTAGS" ]; then
            gtags
        fi
        global -u
    else
        echo "$JSON not found."
        exit 1
    fi
fi
